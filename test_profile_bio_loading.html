<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Profile Section Bio Loading</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-results { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Profile Section Bio Loading Test</h1>
    <button onclick="testDirectProfileAccess()">Test Direct Profile Access</button>
    <button onclick="testBioPopulation()">Test Bio Population Logic</button>
    
    <div id="testResults"></div>
    
    <!-- Simulate bio field -->
    <h3>Simulated Bio Field:</h3>
    <textarea id="artistBio" placeholder="Bio will be populated here..."></textarea>
    <p>Characters: <span id="bioCharCount">0</span></p>
    
    <script>
        // Test direct profile access
        async function testDirectProfileAccess() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="test-results info">üîç Testing direct profile access...</div>';
            
            try {
                // Test API call without artist_id (should use cookie)
                console.log('üîç Testing profile access without artist_id parameter...');
                const response = await fetch('./API/getArtistInfo.php', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üì° API Response:', data);
                
                if (data.success && data.data) {
                    const artistData = data.data;
                    
                    resultsDiv.innerHTML = `
                        <div class="test-results success">
                            <h3>‚úÖ Profile Access Test Results:</h3>
                            <p><strong>API Success:</strong> ${data.success}</p>
                            <p><strong>Artist ID:</strong> ${artistData.id}</p>
                            <p><strong>Full Name:</strong> ${artistData.full_name}</p>
                            <p><strong>Bio Field:</strong> "${artistData.bio}"</p>
                            <p><strong>Bio Length:</strong> ${(artistData.bio || '').length} characters</p>
                            <p><strong>Artist Bio Field:</strong> "${artistData.artist_bio}"</p>
                            <p><strong>Bio Available for Form:</strong> ${artistData.bio ? '‚úÖ Yes' : '‚ùå No'}</p>
                        </div>
                    `;
                    
                    // Test the population logic
                    testBioPopulationWithData(artistData);
                    
                } else {
                    resultsDiv.innerHTML = `
                        <div class="test-results error">
                            <h3>‚ùå API Error:</h3>
                            <p><strong>Success:</strong> ${data.success}</p>
                            <p><strong>Message:</strong> ${data.message || 'Unknown error'}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                resultsDiv.innerHTML = `
                    <div class="test-results error">
                        <h3>‚ùå Test Error:</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Test bio population logic with data
        function testBioPopulationWithData(artistData) {
            console.log('üîÑ Testing bio population with data:', artistData);
            
            // Simulate the populateProfileForm bio logic
            const artistBio = document.getElementById('artistBio');
            if (artistBio) {
                const bioValue = artistData.bio || '';
                artistBio.value = bioValue;
                console.log('üìù Bio populated with:', bioValue);
                console.log('üìù Bio length:', bioValue.length);
                
                // Update character count
                const charCount = document.getElementById('bioCharCount');
                if (charCount) {
                    charCount.textContent = bioValue.length;
                    console.log('üìù Bio character count updated to:', bioValue.length);
                }
                
                // Add success message
                const existingResults = document.getElementById('testResults').innerHTML;
                document.getElementById('testResults').innerHTML = existingResults + `
                    <div class="test-results success">
                        <h3>‚úÖ Bio Population Test:</h3>
                        <p><strong>Bio Field Found:</strong> ‚úÖ Yes</p>
                        <p><strong>Bio Value Set:</strong> "${bioValue}"</p>
                        <p><strong>Character Count Updated:</strong> ${bioValue.length}</p>
                        <p><strong>Form Population:</strong> ‚úÖ Successful</p>
                    </div>
                `;
            } else {
                console.warn('‚ùå Bio field not found');
                const existingResults = document.getElementById('testResults').innerHTML;
                document.getElementById('testResults').innerHTML = existingResults + `
                    <div class="test-results error">
                        <h3>‚ùå Bio Population Test:</h3>
                        <p><strong>Bio Field Found:</strong> ‚ùå No</p>
                        <p>Could not find bio field element</p>
                    </div>
                `;
            }
        }
        
        // Test bio population logic separately
        async function testBioPopulation() {
            console.log('üîç Testing bio population logic...');
            
            // Simulate artist data with bio
            const testArtistData = {
                bio: "Testing bio update - this should save in the bio field, not w",
                artist_bio: "test for the upadate",
                full_name: "Test Artist",
                id: 17
            };
            
            testBioPopulationWithData(testArtistData);
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            console.log('üöÄ Page loaded, ready for testing');
        });
    </script>
</body>
</html>
