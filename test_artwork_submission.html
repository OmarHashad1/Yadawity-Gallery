<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Artwork Creation with Primary Image</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { max-width: 600px; margin: 0 auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; margin-bottom: 5px; }
        .upload-zone { 
            border: 2px dashed #ccc; 
            padding: 20px; 
            text-align: center; 
            margin: 10px 0;
            cursor: pointer;
        }
        .upload-zone:hover { border-color: #007bff; }
        .image-preview { 
            max-width: 200px; 
            max-height: 200px; 
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .result { 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test Artwork Creation with Primary Image</h1>
        
        <form id="testArtworkForm">
            <div class="form-group">
                <label for="title">Artwork Title *</label>
                <input type="text" id="title" name="title" value="Test Painting" required>
            </div>
            
            <div class="form-group">
                <label for="description">Description *</label>
                <textarea id="description" name="description" required>This is a test artwork to verify primary image functionality.</textarea>
            </div>
            
            <div class="form-group">
                <label for="price">Price (EGP) *</label>
                <input type="number" id="price" name="price" value="100" step="0.01" required>
            </div>
            
            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" name="category" required>
                    <option value="paintings">Paintings</option>
                    <option value="sculptures">Sculptures</option>
                    <option value="textiles">Textiles</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="style">Art Style *</label>
                <select id="style" name="style" required>
                    <option value="abstract">Abstract</option>
                    <option value="realism">Realism</option>
                    <option value="contemporary">Contemporary</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="width">Width (cm) *</label>
                <input type="number" id="width" name="width" value="50" step="0.1" required>
            </div>
            
            <div class="form-group">
                <label for="height">Height (cm) *</label>
                <input type="number" id="height" name="height" value="70" step="0.1" required>
            </div>
            
            <div class="form-group">
                <label>Primary Image *</label>
                <div class="upload-zone" id="primaryUploadZone">
                    <p>Click here to select primary image</p>
                    <input type="file" id="primaryImage" accept="image/*" style="display: none;" required>
                </div>
                <div id="primaryPreview"></div>
            </div>
            
            <div class="form-group">
                <label>Additional Images (Optional)</label>
                <div class="upload-zone" id="additionalUploadZone">
                    <p>Click here to select additional images</p>
                    <input type="file" id="additionalImages" accept="image/*" multiple style="display: none;">
                </div>
                <div id="additionalPreview"></div>
            </div>
            
            <button type="button" onclick="testSubmission()">Test Artwork Submission</button>
        </form>
        
        <div id="result"></div>
    </div>

    <script>
        let primaryImageFile = null;
        let additionalImageFiles = [];

        // Primary image handling
        document.getElementById('primaryUploadZone').addEventListener('click', () => {
            document.getElementById('primaryImage').click();
        });

        document.getElementById('primaryImage').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                primaryImageFile = file;
                showImagePreview(file, 'primaryPreview', 'Primary Image: ' + file.name);
            }
        });

        // Additional images handling
        document.getElementById('additionalUploadZone').addEventListener('click', () => {
            document.getElementById('additionalImages').click();
        });

        document.getElementById('additionalImages').addEventListener('change', (e) => {
            additionalImageFiles = Array.from(e.target.files);
            let previewHtml = '';
            additionalImageFiles.forEach((file, index) => {
                previewHtml += `<p>Additional Image ${index + 1}: ${file.name}</p>`;
            });
            document.getElementById('additionalPreview').innerHTML = previewHtml;
        });

        function showImagePreview(file, containerId, label) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById(containerId).innerHTML = `
                    <p>${label}</p>
                    <img src="${e.target.result}" alt="Preview" class="image-preview">
                `;
            };
            reader.readAsDataURL(file);
        }

        async function testSubmission() {
            const resultDiv = document.getElementById('result');
            
            if (!primaryImageFile) {
                resultDiv.innerHTML = '<div class="error">Please select a primary image!</div>';
                return;
            }

            // Create FormData
            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('style', document.getElementById('style').value);
            formData.append('width', document.getElementById('width').value);
            formData.append('height', document.getElementById('height').value);
            formData.append('artist_id', '1'); // Test artist ID
            
            // Add primary image
            formData.append('primary_image', primaryImageFile);
            
            // Add additional images
            additionalImageFiles.forEach(file => {
                formData.append('artwork_images[]', file);
            });

            resultDiv.innerHTML = '<div class="info">Submitting artwork...</div>';

            try {
                const response = await fetch('./API/addArtwork.php', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>✅ Artwork Created Successfully!</h3>
                            <p><strong>Artwork ID:</strong> ${result.artwork_id}</p>
                            <p><strong>Primary Image:</strong> ${result.artwork_image || 'Not set'}</p>
                            <p><strong>Additional Images:</strong> ${result.additional_images_count || 0}</p>
                            <p><strong>Total Images in artwork_photos:</strong> ${result.total_photos || 0}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>❌ Error Creating Artwork</h3>
                            <p>${result.message}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ Network Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Add some helpful info
        window.addEventListener('load', () => {
            document.getElementById('result').innerHTML = `
                <div class="info">
                    <h3>ℹ️ Test Instructions</h3>
                    <ol>
                        <li>Fill in the required artwork details</li>
                        <li>Select a primary image (required)</li>
                        <li>Optionally select additional images</li>
                        <li>Click "Test Artwork Submission" to test the functionality</li>
                    </ol>
                    <p><strong>This test will:</strong></p>
                    <ul>
                        <li>Create a new artwork record</li>
                        <li>Store the primary image in the artwork_image column</li>
                        <li>Store all images (primary + additional) in artwork_photos table</li>
                        <li>Mark the primary image with is_primary = 1</li>
                    </ul>
                </div>
            `;
        });
    </script>
</body>
</html>
