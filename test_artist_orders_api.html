<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Artist Orders API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #6b4423;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #4a2c17;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 500px;
            overflow-y: auto;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .cookie-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 20px;
        }
        
        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .pagination button {
            background: #6b4423;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #4a2c17;
            transform: translateY(-1px);
        }
        
        .pagination button:disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .pagination .page-info {
            color: #6b4423;
            font-weight: 600;
            min-width: 120px;
            text-align: center;
            padding: 8px 16px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        
        /* Order Status Styles */
        .order-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .order-status.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .order-status.processing {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        
        .order-status.shipped {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .order-status.delivered {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .order-status.cancelled {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .order-status.paid {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .order-status.unpaid {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .order-status.refunded {
            background: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Artist Orders API Test</h1>
        
        <div class="cookie-info">
            <strong>Cookie Status:</strong> <span id="cookieStatus">Checking...</span><br>
            <strong>User Login Cookie:</strong> <span id="cookieValue">Not found</span>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="testGetOrders()">Get All Orders</button>
            <button class="btn" onclick="testGetOrdersPending()">Get Pending Orders</button>
            <button class="btn" onclick="testGetOrdersPaid()">Get Paid Orders</button>
            <button class="btn" onclick="testGetOrdersWithLimit()">Get Orders (Limit 5)</button>
            <button class="btn" onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="status"></div>
        <div id="result" class="result"></div>
    </div>

    <script>
        // Check cookie status on load
        document.addEventListener('DOMContentLoaded', function() {
            checkCookieStatus();
        });

        function checkCookieStatus() {
            const cookies = document.cookie.split(';');
            let userLoginCookie = null;
            
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'user_login') {
                    userLoginCookie = value;
                    break;
                }
            }
            
            const cookieStatus = document.getElementById('cookieStatus');
            const cookieValue = document.getElementById('cookieValue');
            
            if (userLoginCookie) {
                cookieStatus.textContent = 'Found';
                cookieStatus.style.color = 'green';
                cookieValue.textContent = userLoginCookie;
            } else {
                cookieStatus.textContent = 'Not found - You need to login first';
                cookieStatus.style.color = 'red';
                cookieValue.textContent = 'Please login to test the API';
            }
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showResult(data) {
            const resultDiv = document.getElementById('result');
            
            if (data.success && data.data && data.data.orders) {
                // Format the orders data with better styling
                let formattedResult = `{\n  "success": ${data.success},\n  "message": "${data.message}",\n  "data": {\n    "orders": [\n`;
                
                data.data.orders.forEach((order, index) => {
                    const statusClass = getStatusClass(order.status);
                    formattedResult += `      {\n`;
                    formattedResult += `        "id": ${order.id},\n`;
                    formattedResult += `        "order_number": "${order.order_number}",\n`;
                    formattedResult += `        "buyer_name": "${order.buyer_name}",\n`;
                    formattedResult += `        "total_amount": "$${order.total_amount}",\n`;
                    formattedResult += `        "status": "${order.status}" [${statusClass}],\n`;
                    formattedResult += `        "order_date": "${order.order_date}",\n`;
                    if (order.items && order.items.length > 0) {
                        formattedResult += `        "items": [\n`;
                        order.items.forEach((item, itemIndex) => {
                            formattedResult += `          {\n`;
                            formattedResult += `            "artwork_title": "${item.artwork_title}",\n`;
                            formattedResult += `            "price": "$${item.price}",\n`;
                            formattedResult += `            "quantity": ${item.quantity},\n`;
                            formattedResult += `            "subtotal": "$${item.subtotal}"\n`;
                            formattedResult += `          }${itemIndex < order.items.length - 1 ? ',' : ''}\n`;
                        });
                        formattedResult += `        ]\n`;
                    }
                    formattedResult += `      }${index < data.data.orders.length - 1 ? ',' : ''}\n`;
                });
                
                formattedResult += `    ],\n`;
                formattedResult += `    "pagination": {\n`;
                formattedResult += `      "current_page": ${data.data.pagination?.current_page || 1},\n`;
                formattedResult += `      "total_pages": ${data.data.pagination?.total_pages || 1},\n`;
                formattedResult += `      "total_orders": ${data.data.pagination?.total_orders || data.data.orders.length},\n`;
                formattedResult += `      "orders_per_page": ${data.data.pagination?.orders_per_page || 10}\n`;
                formattedResult += `    },\n`;
                formattedResult += `    "statistics": {\n`;
                formattedResult += `      "total_revenue": "$${data.data.statistics?.total_revenue || '0.00'}",\n`;
                formattedResult += `      "total_orders": ${data.data.statistics?.total_orders || 0},\n`;
                formattedResult += `      "pending_orders": ${data.data.statistics?.pending_orders || 0},\n`;
                formattedResult += `      "completed_orders": ${data.data.statistics?.completed_orders || 0}\n`;
                formattedResult += `    }\n`;
                formattedResult += `  }\n}`;
                
                resultDiv.textContent = formattedResult;
                
                // Add pagination if available
                if (data.data.pagination && data.data.pagination.total_pages > 1) {
                    addPaginationControls(data.data.pagination);
                }
            } else {
                resultDiv.textContent = JSON.stringify(data, null, 2);
            }
        }
        
        function getStatusClass(status) {
            const statusMap = {
                'pending': 'PENDING',
                'processing': 'PROCESSING', 
                'shipped': 'SHIPPED',
                'delivered': 'DELIVERED',
                'cancelled': 'CANCELLED',
                'paid': 'PAID',
                'unpaid': 'UNPAID',
                'refunded': 'REFUNDED'
            };
            return statusMap[status.toLowerCase()] || status.toUpperCase();
        }
        
        function addPaginationControls(pagination) {
            // Remove existing pagination
            const existingPagination = document.querySelector('.pagination');
            if (existingPagination) {
                existingPagination.remove();
            }
            
            // Create new pagination
            const paginationDiv = document.createElement('div');
            paginationDiv.className = 'pagination';
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.innerHTML = '← Previous';
            prevBtn.disabled = pagination.current_page <= 1;
            prevBtn.onclick = () => {
                if (pagination.current_page > 1) {
                    loadPage(pagination.current_page - 1);
                }
            };
            
            // Page info
            const pageInfo = document.createElement('span');
            pageInfo.className = 'page-info';
            pageInfo.textContent = `Page ${pagination.current_page} of ${pagination.total_pages}`;
            
            // Next button  
            const nextBtn = document.createElement('button');
            nextBtn.innerHTML = 'Next →';
            nextBtn.disabled = pagination.current_page >= pagination.total_pages;
            nextBtn.onclick = () => {
                if (pagination.current_page < pagination.total_pages) {
                    loadPage(pagination.current_page + 1);
                }
            };
            
            paginationDiv.appendChild(prevBtn);
            paginationDiv.appendChild(pageInfo);
            paginationDiv.appendChild(nextBtn);
            
            // Insert after result div
            const resultDiv = document.getElementById('result');
            resultDiv.parentNode.insertBefore(paginationDiv, resultDiv.nextSibling);
        }
        
        function loadPage(page) {
            const params = new URLSearchParams(window.location.search);
            makeRequest('/API/getArtistOrders.php', { 
                page: page,
                limit: 10,
                status: params.get('status') || ''
            });
        }

        function clearResults() {
            document.getElementById('result').textContent = '';
            document.getElementById('status').innerHTML = '';
            
            // Remove pagination if it exists
            const existingPagination = document.querySelector('.pagination');
            if (existingPagination) {
                existingPagination.remove();
            }
        }

        async function makeRequest(url, params = {}) {
            try {
                showStatus('Making request...', 'info');
                
                const queryString = new URLSearchParams(params).toString();
                const fullUrl = queryString ? `${url}?${queryString}` : url;
                
                console.log('Request URL:', fullUrl);
                
                const response = await fetch(fullUrl, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showStatus(`Success! Found ${data.data.orders ? data.data.orders.length : 0} orders`, 'success');
                } else {
                    showStatus(`Error: ${data.message || 'Unknown error'}`, 'error');
                }
                
                showResult(data);
                
            } catch (error) {
                console.error('Request error:', error);
                showStatus(`Network Error: ${error.message}`, 'error');
                showResult({ error: error.message, stack: error.stack });
            }
        }

        function testGetOrders() {
            makeRequest('/API/getArtistOrders.php');
        }

        function testGetOrdersPending() {
            makeRequest('/API/getArtistOrders.php', { status: 'pending' });
        }

        function testGetOrdersPaid() {
            makeRequest('/API/getArtistOrders.php', { status: 'paid' });
        }

        function testGetOrdersWithLimit() {
            makeRequest('/API/getArtistOrders.php', { limit: 5, offset: 0 });
        }
    </script>
</body>
</html>
