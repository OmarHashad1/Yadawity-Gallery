<!DOCTYPE html>
<html>
<head>
    <title>Cookie Debug Test</title>
</head>
<body>
    <h1>Cookie Authentication Debug</h1>
    <div id="debug-info">
        <p><strong>Current Cookies:</strong> <span id="current-cookies"></span></p>
        <p><strong>User Cookie:</strong> <span id="user-cookie"></span></p>
        <button onclick="setCookie()">Set Test Cookie</button>
        <button onclick="testAPI()">Test API</button>
        <button onclick="clearCookies()">Clear Cookies</button>
    </div>
    <div id="result"></div>

    <script>
        function updateDisplay() {
            document.getElementById('current-cookies').textContent = document.cookie || 'None';
            document.getElementById('user-cookie').textContent = getUserCookie() || 'None';
        }

        function getUserCookie() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'user_login') {
                    return value;
                }
            }
            return null;
        }

        function setCookie() {
            const testUserCookie = '1_92022b808b38754ceb03807fa2c87427f9f306b2bcea8bea0eeafa0cfaf3f831';
            const expires = new Date();
            expires.setTime(expires.getTime() + (30 * 24 * 60 * 60 * 1000)); // 30 days
            document.cookie = `user_login=${testUserCookie}; path=/; expires=${expires.toUTCString()}; SameSite=Lax`;
            
            setTimeout(updateDisplay, 100);
            console.log('Cookie set:', testUserCookie);
        }

        function clearCookies() {
            document.cookie = 'user_login=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT;';
            setTimeout(updateDisplay, 100);
        }

        async function testAPI() {
            try {
                const response = await fetch('./API/getArtistReviews.php?type=all&page=1&limit=2', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const responseText = await response.text();
                console.log('Response status:', response.status);
                console.log('Response text:', responseText);

                document.getElementById('result').innerHTML = `
                    <h3>API Test Result</h3>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre>${responseText}</pre>
                `;

            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        // Update display on load
        window.onload = updateDisplay;
    </script>
</body>
</html>
